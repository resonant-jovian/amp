<!DOCTYPE html>
<html>
<head>
    <title>AMP Testing Interface - {ADDRESS}</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="stadsatlas_interface.css">
    <style>
        /* CRITICAL: Force explicit dimensions for Origo/OpenLayers rendering */
        /* These inline styles override any conflicting CSS and ensure map container has size */
        * {
            margin: 0 !important;
            padding: 0 !important;
            box-sizing: border-box !important;
        }
        html {
            height: 100% !important;
            width: 100% !important;
        }
        body {
            height: 100% !important;
            width: 100% !important;
            margin: 0 !important;
            padding: 0 !important;
            display: flex !important;
            flex-direction: column !important;
        }
        .map-section {
            height: 550px !important;
            min-height: 550px !important;
            width: 100% !important;
            max-width: 100% !important;
            flex-shrink: 0 !important;
            display: flex !important;
            flex-direction: column !important;
            margin: 0 !important;
            padding: 0 !important;
        }
        .map-container {
            height: 100% !important;
            width: 100% !important;
            max-width: 100% !important;
            position: relative !important;
            flex: 1 !important;
            min-height: 0 !important;
            display: flex !important;
            flex-direction: column !important;
            margin: 0 !important;
            padding: 0 !important;
        }
        .control-panel {
            flex-shrink: 0 !important;
        }
        .stadsatlas-iframe {
            width: 100% !important;
            height: 100% !important;
            border: none !important;
        }
        .tab-container {
            flex: 1 !important;
            display: flex !important;
            flex-direction: column !important;
            width: 100% !important;
            max-width: 100% !important;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üìç AMP Correlation Testing Interface</h1>
        <div class="address">{ADDRESS}</div>
    </div>
    
    <!-- Map Container - Always visible at top -->
    <div class="map-section">
        <div class="control-panel">
            <button class="control-button" onclick="searchAddress()">üîç Search Address & Load Map</button>
            <span id="status-indicator" class="status-text">Ready to search</span>
        </div>
        <div id="map-container" class="map-container">
            <div class="map-placeholder">Map will load here after search</div>
            <iframe id="stadsatlas-iframe" class="stadsatlas-iframe" src="" frameborder="0" style="display:none;"></iframe>
        </div>
    </div>
    
    <!-- Tab Container - Below the map -->
    <div class="tab-container">
        <div class="tab-buttons">
            <button class="tab-btn" onclick="switchTab(event, 1)">üìã Instructions</button>
            <button class="tab-btn active" onclick="switchTab(event, 2)">üìä Data</button>
            <button class="tab-btn" onclick="switchTab(event, 3)">üêõ Debug</button>
        </div>
        
        <div id="tab1" class="tab-content">
            <h1>üìã Address Verification Instructions</h1>
            <div class="instruction">‚úì Follow these steps to verify the address</div>
            <div class="address-display">{ADDRESS}</div>
            <div class="steps">
                <div class="step"><strong>Click "Search Address & Load Map"</strong> at the top. This will call Malm√∂'s geo API and display the map above, centered on the found coordinates.</div>
                <div class="step">The map will load in the container above, centered at the exact address coordinates with a pin marker.</div>
                <div class="step">Once the map loads, verify that the location is correct by checking nearby street names and landmarks.</div>
                <div class="step">The <strong>Milj√∂parkering layer</strong> should be automatically activated. You can toggle other layers using the Layers panel on the right side of the map.</div>
                <div class="step">Verify the parking zone information displayed on the map matches the correlation data shown in the Data tab.</div>
            </div>
            <div class="note">üí° <strong>How it works:</strong> The API returns coordinates in WKT POINT format (POINT(X Y)) which we parse and pass directly to StadsAtlas. The map displays the pin at those coordinates and attempts to activate the milj√∂data layer.</div>
        </div>
        
        <div id="tab2" class="tab-content active">
            <h1>üìä Correlation Result Data</h1>
            <div class="field">
                <div class="label">Address</div>
                <div class="value">{RESULT_ADDRESS}</div>
            </div>
            <div class="field">
                <div class="label">Postal Code</div>
                <div class="value">{RESULT_POSTNUMMER}</div>
            </div>
            <div class="field">
                <div class="label">Dataset Source</div>
                <div class="value">{RESULT_SOURCE}</div>
            </div>
            <h2>Matched Zones</h2>
            <div id="matches-container">{RESULT_MATCHES}</div>
        </div>
        
        <div id="tab3" class="tab-content">
            <h1>üêõ Debug Console - Address Search Logs</h1>
            <div class="note"><strong>Status:</strong> All address searches are logged below. Also check browser DevTools Console (F12) for extended logs marked with <code>[AMP]</code>.</div>
            <div class="field">
                <div class="label">Search Status</div>
                <div class="value" id="search-status">Ready to search...</div>
            </div>
            <div class="label" style="margin-top: 20px;">Message Logs</div>
            <div class="console-log" id="message-logs"></div>
        </div>
    </div>
    
    <script src="stadsatlas_interface.js"></script>
</body>
</html>